name: Deploy All

on:
  workflow_dispatch:
  workflow_call:

jobs:
  deploy_all:
    runs-on: ubuntu-latest
    steps:
    - name: Configure ssh key
      env:
        PRIVATE_KEY: ${{ secrets.GROCERIES_PRIVATE_KEY }}
      run: |
        echo $PRIVATE_KEY > id_rsa_groceries
        chmod 600 id_rsa_groceries
    - name: Docker Compose up
      env:
        HOST: "149.130.209.48"
      run: |
        ssh -i id_rsa_groceries -o "StrictHostKeyChecking no" groceries@$HOST "
          curl -o docker-compose.yaml https://raw.githubusercontent.com/collinmurd/groceries/main/docker-compose-prod.yaml
          docker compose up -d
        "